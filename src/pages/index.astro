---
import "../styles/global.css";
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon-light-mode.svg" media="(prefers-color-scheme: light)" />
		<link rel="icon" type="image/svg+xml" href="/favicon-dark-mode.svg" media="(prefers-color-scheme: dark)" />
		<link rel="icon" type="image/svg+xml" href="/favicon-dark-mode.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Amet Alvirde</title>
		<script>
			// Theme management - runs before page load to prevent flash
			(function(): void {
				type ThemePreference = 'light' | 'dark' | 'system';
				type ActualTheme = 'light' | 'dark';
				
				const getThemePreference = (): ThemePreference => {
					const stored = localStorage.getItem('theme') as ThemePreference | null;
					if (stored) return stored;
					return 'system'; // Default to system preference
				};
				
				const getSystemTheme = (): ActualTheme => {
					return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
				};
				
				const getActualTheme = (preference: ThemePreference): ActualTheme => {
					if (preference === 'system') {
						return getSystemTheme();
					}
					return preference as ActualTheme;
				};
				
				const preference: ThemePreference = getThemePreference();
				const actualTheme: ActualTheme = getActualTheme(preference);
				document.documentElement.setAttribute('data-theme', actualTheme);
				document.documentElement.setAttribute('data-theme-preference', preference);
				
				// Set initial favicon
				const setInitialFavicon = (): void => {
					const favicon = document.querySelector('link[rel="icon"]:not([media])') as HTMLLinkElement | null;
					if (favicon) {
						favicon.href = actualTheme === 'light' ? '/favicon-light-mode.svg' : '/favicon-dark-mode.svg';
					}
				};
				
				// Set favicon once DOM is ready
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', setInitialFavicon);
				} else {
					setInitialFavicon();
				}
			})();
		</script>
	</head>
	<body style="background-color: rgb(var(--bg-primary)); color: rgb(var(--text-primary));" class="h-[100dvh] flex flex-col items-center mt-[10dvh]">
		<style>
			body {
				selection-background-color: rgb(var(--selection-bg));
				selection-color: rgb(var(--selection-text));
			}
			
			::selection {
				background-color: rgb(var(--selection-bg));
				color: rgb(var(--selection-text));
			}
		</style>
		
		<!-- Theme Controls -->
		<div class="fixed top-6 right-6 flex gap-2">
			<!-- System Theme Button -->
			<button class="theme-button" id="system-theme-toggle" aria-label="Use system theme" title="Follow system theme">
				<svg fill="currentColor" viewBox="0 0 20 20">
					<path fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" clip-rule="evenodd"></path>
				</svg>
			</button>
			
			<!-- Manual Theme Toggle Button -->
			<button class="theme-button" id="theme-toggle" aria-label="Toggle theme manually" title="Toggle between light and dark theme">
				<svg id="sun-icon" class="hidden" fill="currentColor" viewBox="0 0 20 20">
					<path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
				</svg>
				<svg id="moon-icon" fill="currentColor" viewBox="0 0 20 20">
					<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
				</svg>
			</button>
		</div>

		<div class="flex flex-col md:flex-row items-center justify-center text-center md:text-left max-w-md md:max-w-4xl w-full md:gap-8">
			<img src="monogram-dark-mode.svg" alt="Amet Alvirde Monogram" class="w-xs h-auto mb-4 md:mb-0 md:flex-shrink-0" id="monogram" />
			<section id="about" class="flex flex-col items-center md:items-start justify-center text-center md:text-left max-w-md md:max-w-none w-full">
			<h1 class="text-3xl font-bold mb-6 md:text-4xl" style="color: rgb(var(--text-primary));">Amet Alvirde</h1>
			<p class="text-base mx-10 md:mx-0 text-balance leading-relaxed md:text-lg" style="color: rgb(var(--text-secondary));">
				Experiencia humana polímata viviendo un sistema de múltiples consciencias a través del ininterrumpido, inevitable e irreversible viaje hacia mi destino.
			</p>

			</section>
		</div>

		<!-- Bottom Stripes -->
		<div class="fixed bottom-0 left-0 right-0 flex flex-col z-10">
			<div class="h-1 md:h-2 bg-accent"></div>
			<div class="h-1 md:h-2 bg-text-primary"></div>
		</div>

		<script>
			import { initializeThemeManager } from '../utils/theme-manager.ts';
			
			document.addEventListener('DOMContentLoaded', () => {
				initializeThemeManager();
			});
		</script>
	</body>
</html>
